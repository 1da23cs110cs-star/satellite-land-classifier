<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Satellite Land Classifier — Results</title>

<style>
:root{
  --header-start:#2fc0ff;
  --header-end:#00a3ff;
  --bg:#f7fbff;
  --card:#ffffff;
  --ink:#042a3f;
  --muted:#6b8896;
  --accent:#0077ff;
}
body{margin:0;font-family:Inter,Arial,Helvetica;background:linear-gradient(180deg,var(--bg),#eef8ff);color:var(--ink)}
.header{display:flex;align-items:center;gap:12px;padding:16px;background:linear-gradient(90deg,var(--header-start),var(--header-end));color:white}
.header .icon{width:56px;height:56px;border-radius:12px;background:white;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.12);animation:pulse 2.6s ease-in-out infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.035)}100%{transform:scale(1)}}
.container{max-width:1100px;margin:20px auto;padding:18px;display:flex;gap:18px}
.left{width:420px;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 12px 36px rgba(0,0,0,0.06)}
.right{flex:1;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 12px 36px rgba(0,0,0,0.06)}
img{width:100%;border-radius:8px}
h2{margin:0;color:var(--ink)}
.legend{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.swatch{width:18px;height:14px;border-radius:4px;border:1px solid rgba(0,0,0,0.06)}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px;text-align:left;border-bottom:1px solid #eef6fb}
th{color:var(--accent)}
.small{color:var(--muted);font-size:13px;margin-top:10px}
canvas{max-width:100%}
@media (max-width:900px){.container{flex-direction:column}.left,.right{width:auto}}
</style>
</head>
<body>
  <header class="header">
    <div class="icon" aria-hidden="true">
      <svg viewBox="0 0 64 64" width="36" height="36" xmlns="http://www.w3.org/2000/svg">
        <rect x="12" y="12" width="40" height="28" rx="4" ry="4" fill="#ffffff" stroke="#00a3ff" stroke-width="2"/>
        <rect x="30" y="6" width="4" height="8" rx="1" ry="1" fill="#00a3ff"/>
        <rect x="2" y="22" width="10" height="18" rx="2" ry="2" fill="#0077ff"/>
        <rect x="52" y="22" width="10" height="18" rx="2" ry="2" fill="#0077ff"/>
        <circle cx="32" cy="26" r="6" fill="#00a3ff"/>
        <circle cx="32" cy="26" r="3.2" fill="#ffffff"/>
      </svg>
    </div>
    <div>
      <div style="font-weight:800;font-size:18px">Satellite Land Classifier</div>
      <div style="font-size:13px;opacity:0.95">ESA WorldCover — land-cover breakdown</div>
    </div>
  </header>

  <div class="container">
    <div class="left">
      <h2>Original crop</h2>
      <img src="{{ original_image }}" alt="Original crop"/>
      <div class="small">Classification uses the ESA WorldCover color palette. Pixel counts are from the cropped tile image.</div>
    </div>

    <div class="right">
      <h2>Results</h2>
      <div style="display:flex;gap:18px;align-items:flex-start">
        <div style="flex:1;text-align:center">
          <canvas id="pieChart" width="420" height="420"></canvas>
        </div>
        <div style="width:360px">
          <div id="legendBox" class="legend"></div>

          <table>
            <thead><tr><th>Class</th><th>Pixels</th><th>Percent</th></tr></thead>
            <tbody id="resultsBody">
              {% for r in results %}
              <tr>
                <td style="font-weight:700">{{ r.label }}</td>
                <td>{{ r.count }}</td>
                <td>{{ r.percent }}%</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>

          <div style="margin-top:12px">
            <button onclick="window.print()" style="padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(180deg,#2fc0ff,#00a3ff);color:white;font-weight:700;cursor:pointer">Print / Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- embed JSON safely -->
  <script id="results-data" type="application/json">
    {{ results | tojson }}
  </script>

  <script>
  (function(){
    const raw = document.getElementById('results-data').textContent.trim();
    let results = [];
    try { results = JSON.parse(raw || '[]'); } catch(e) { console.error('Failed to parse results JSON', e); }

    const labels = results.map(r => r.label);
    const percents = results.map(r => r.percent);
    const colors = results.map(r => r.hex);

    // build legend
    const legendBox = document.getElementById('legendBox');
    results.forEach(r => {
      const el = document.createElement('div');
      el.style.display = 'flex';
      el.style.alignItems = 'center';
      el.style.gap = '8px';
      const sw = document.createElement('div');
      sw.className = 'swatch';
      sw.style.background = r.hex;
      el.appendChild(sw);
      const txt = document.createElement('div');
      txt.style.fontSize = '13px';
      txt.style.color = '#042a3f';
      txt.textContent = `${r.label} (${r.id})`;
      el.appendChild(txt);
      legendBox.appendChild(el);
    });

    // Chart
    const ctx = document.getElementById('pieChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: percents,
          backgroundColor: colors,
          borderColor: '#ffffff',
          borderWidth: 1
        }]
      },
      options: {
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(ctx) {
                const pct = ctx.raw;
                return ctx.label + ': ' + pct + '%';
              }
            }
          }
        }
      }
    });
  })();
  </script>
</body>
</html>
